<!DOCTYPE html>
<html>
      <head>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
          


          //Diagramm mit Google.charts erstellen
          google.charts.load('current', {'packages':['corechart']});
          google.charts.setOnLoadCallback(drawChart);
    
          function drawChart() {
    
            var data = google.visualization.arrayToDataTable([
              ['Website', 'Wöchentliche Nutzung in Stunden'],
              ['google.de',     1.2],
              ['chrome:newtab',      2.2],
              ['youtube.de',  3.3],
              ['heise.de', 4.5]
            ]);
            
            var options = {
              backgroundColor: '#424242',
              legendTextStyle: { color: '#ffffff' }
            };
    
            var chart = new google.visualization.PieChart(document.getElementById('piechart'));
            
            chart.draw(data, options);
          }
          //Daten abrufen
          datenLaden();

          function datenLaden(){
  var allKeys;
  //Schlüssel auslesen
  //Aufpassen: .get ist asynchronous Function
  console.log("Daten Laden wird ausgeführt")
  chrome.storage.local.get(null, function(items) {
  allKeys = Object.keys(items);
  allValues = Object.values(items);

  console.log(allValues[0][0])
  
   
  //Auf Schlüssel der letzten Woche filten
  //1000 * 60 * 60 * 24 * 7 Millisekunden pro Woche
  
  //####Code zum filtern auf letzte Woche noch einfügen
  
  //Alle Werte auslesen
  //Index 0 ist URL, Index 1 ist Dauer
  //
  werte=allValues;
  
  //URLs nach SecondLevelDomain bereinigen
  //  \/\/\S+\.
  //Regex, dass vom //nach http bis zum ersten Punk Matcht. Ist ok, man konnte die TopLevel Domain noch mit auslesen.
  //Durch Array Werte iterieren und das erste Element(URL) ändern
  //werte.forEach(function(part, index, theArray) {
  //theArray[index][0] = theArray[index][0].match('\/\/\S+\.');
  //});

  //Von jedem Eintrag die ersten 2 und letzte Stelle des Strings löschen.

  //Nach URL gruppieren
  urls = []


  //Uber alle Werte iterieren und einzigartige URLS in die Liste urls einfuegen
  for (const element of werte){
      if (!(urls.includes(element[0]))){
        urls.push(element[0])
      }
  }

  //Aus den einzigartien URLs wird die Liste Ergebnisse erzeugt, welche mit der URL und einer 0 als Dauer initialisiert wird.
  ergebnisse =[]
  for (const element of urls){
    ergebnisse.push([element, 0])
  }

  //Ueber alle Werte iterieren und Zeiten addieren, wenn die URLs übereinstimmen
  for (const element of werte){
    for (const a of ergebnisse){
      if(element[0] == a[0]){
        a[1] += element[1]
    }
    }
  }
  console.log(ergebnisse)
  //Jetzt sollten in Ergebnisse alle Zeiten zu den URLs addiert sein.
});
}
        </script>
    
    </head>

<body style="background-color:#424242;">

<h1 style="color: white", align="center">Dashboard</h1>


<script>
function nameSpeichern() {
    console.log("Value is set");
    var input = document.getElementById("Name").value;
    console.log(input);
    document.getElementById("nameAbfrage").style.display = 'none';
    document.getElementById("nameAnzeigen").style.display = 'block';

    chrome.storage.local.set({ Name: input }).then(() => {
        console.log("LocalStorage");
        });
  };

</script>
    

<div style="display: inline">
    <div style="width:49%; display: inline-block; float:left; margin-right: 10px; margin-top: 50px;">
        <h2 style="color: white", align="center">Wöchentliche Nutzungsdauer</h2>
        <h3 style="color: white", align="center">4h 23Min.</h3>
    </div>
    <div style="width: 49%; display: inline-block; margin-top: 50px;">
        <h2 style="color: white", align="center">Genutzte Seiten</h2>
        <div id="piechart" align="center" style="width: 700px; height: 300px;"></div>
    </div>
</div>

<div style="display: inline">
    <div style="width:49%; display: inline-block; float:left; margin-right: 10px; margin-top: 50px;">
        <h2 style="color: white", align="center">Verbundene Geräte</h2>
    </div>
    <div style="width: 49%; display: inline-block; margin-top: 50px;">
        <h2 style="color: white", align="center"></h2>
    </div>
</div>


</body>
    
</html> 